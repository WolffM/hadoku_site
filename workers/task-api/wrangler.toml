name = "task-api"
main = "src/index.ts"
compatibility_date = "2025-10-11"
workers_dev = true

# Observability settings
[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

# Build configuration
[build]
command = ""

# Specify tsconfig to avoid scanning parent directories
[build.upload]
format = "modules"

# Use node compat flag (compatibility_flags replaces node_compat)
compatibility_flags = ["nodejs_compat"]

# Routes removed - edge-router will proxy to workers.dev URL
# routes = [
#   { pattern = "task-api.hadoku.me/task/api/*", zone_name = "hadoku.me" },
#   { pattern = "task-api.hadoku.me/task/api", zone_name = "hadoku.me" }
# ]

# KV Namespaces - Task storage
[[kv_namespaces]]
binding = "TASKS_KV"
id = "6cdcc2053b224eb1819a680be8342eb3"
preview_id = "3fb96829c28b497a9101dd554c97fdec"

# Environment variables (no longer needed - using KV)
# [vars]
# REPO_OWNER = "WolffM"
# REPO_NAME = "hadoku_site"
# REPO_BRANCH = "main"

# Secrets (set via: wrangler secret put <NAME>)
# Authentication keys are JSON objects mapping keys to userIds:
# - ADMIN_KEYS: JSON object, e.g., '{"key1": "user1", "key2": "user2"}'
# - FRIEND_KEYS: JSON object, e.g., '{"key1": "user1", "key2": "user2"}'
#
# To update: cd workers/task-api && echo '{"key1": "user1"}' | pnpm exec wrangler secret put ADMIN_KEYS
