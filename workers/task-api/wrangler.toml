name = "task-api"
main = "src/index.ts"
compatibility_date = "2025-10-11"
compatibility_flags = ["nodejs_compat"]
workers_dev = true

# Observability settings - logs visible in Cloudflare dashboard
[observability]
enabled = true
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true

# Build configuration
[build]
command = ""

# Routes removed - edge-router will proxy to workers.dev URL
# routes = [
#   { pattern = "task-api.hadoku.me/task/api/*", zone_name = "hadoku.me" },
#   { pattern = "task-api.hadoku.me/task/api", zone_name = "hadoku.me" }
# ]

# KV Namespaces - Task storage
[[kv_namespaces]]
binding = "TASKS_KV"
id = "6cdcc2053b224eb1819a680be8342eb3"
preview_id = "3fb96829c28b497a9101dd554c97fdec"

# D1 Database - Task events and analytics
[[d1_databases]]
binding = "DB"
database_name = "task-events"
database_id = "17f9ea29-8035-40a5-bab0-defdfd32d7d4"
preview_database_id = "5400ec8a-0951-446f-8124-f8ef86bd2165"

# Environment variables (no longer needed - using KV)
# [vars]
# REPO_OWNER = "WolffM"
# REPO_NAME = "hadoku_site"
# REPO_BRANCH = "main"

# Secrets (set via: wrangler secret put <NAME>)
# Authentication keys are JSON objects mapping keys to userIds:
# - ADMIN_KEYS: JSON object, e.g., '{"key1": "user1", "key2": "user2"}'
# - FRIEND_KEYS: JSON object, e.g., '{"key1": "user1", "key2": "user2"}'
#
# To update: cd workers/task-api && echo '{"key1": "user1"}' | pnpm exec wrangler secret put ADMIN_KEYS
