name = "edge-router"
main = "src/index.ts"
compatibility_date = "2025-10-11"

# Routes - only intercept API paths, let static content pass through
routes = [
  { pattern = "hadoku.me/task/api*", zone_name = "hadoku.me" },
  { pattern = "hadoku.me/watchparty/api*", zone_name = "hadoku.me" }
]

# Environment variables
[vars]
ROUTE_CONFIG = '{"global_priority":"12"}'  # Priority: 1=tunnel, 2=worker (enabled!)
LOCAL_BASE = "https://local-api.hadoku.me"  # Tunnel host (avoid loops)
WORKER_BASE = "https://task-api.jamescannon4237-cfd.workers.dev"  # Task API Worker
LAMBDA_BASE = ""
STATIC_ORIGIN = "https://wolffm.github.io/hadoku_site/"

# Analytics Engine binding (automatic logging, zero setup)
[[analytics_engine_datasets]]
binding = "ANALYTICS_ENGINE"

# Optional: Service binding to task-api Worker (faster than HTTP)
# [[services]]
# binding = "TASK_API"
# service = "task-api"
