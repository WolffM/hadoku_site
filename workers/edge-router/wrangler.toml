name = "edge-router"
main = "src/index.ts"
compatibility_date = "2025-10-11"

# Enable Workers Logs for observability
[observability]
enabled = true
head_sampling_rate = 1  # Log 100% of requests

[observability.logs]
enabled = true
invocation_logs = true

# Routes - intercept API paths and session management
routes = [
  { pattern = "hadoku.me/session/*", zone_name = "hadoku.me" },
  { pattern = "hadoku.me/task/api*", zone_name = "hadoku.me" },
  { pattern = "hadoku.me/watchparty/api*", zone_name = "hadoku.me" },
  { pattern = "hadoku.me/contact/api*", zone_name = "hadoku.me" },
  { pattern = "hadoku.me/resume/api*", zone_name = "hadoku.me" }
]

# Environment variables
[vars]
ROUTE_CONFIG = '{"global_priority":"12"}'  # Priority: 1=tunnel, 2=worker (enabled!)
LOCAL_BASE = "https://local-api.hadoku.me"  # Tunnel host (avoid loops)
WORKER_BASE = "https://task-api.jamescannon4237-cfd.workers.dev"  # Task API Worker
CONTACT_WORKER_BASE = "https://contact-api.jamescannon4237-cfd.workers.dev"  # Contact API Worker
RESUME_WORKER_BASE = "https://resume-api.jamescannon4237-cfd.workers.dev"  # Resume API Worker
LAMBDA_BASE = ""
STATIC_ORIGIN = "https://wolffm.github.io/hadoku_site/"

# Analytics Engine binding (automatic logging, zero setup)
[[analytics_engine_datasets]]
binding = "ANALYTICS_ENGINE"

# KV Namespace for session management
[[kv_namespaces]]
binding = "SESSIONS_KV"
id = "d2b6af9765194ceeaee92b639505ac1f"
preview_id = "c9ca6763e1804b448a2f6597b8970c16"

# Optional: Service binding to task-api Worker (faster than HTTP)
# [[services]]
# binding = "TASK_API"
# service = "task-api"
